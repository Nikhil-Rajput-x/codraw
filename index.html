<!DOCTYPE html>
<!---
this file is part of project codraw
Author : Nikhil kumar
(c) 2025 uzumaki_arts
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Codraw</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="images/logo.png">
</head>
<body onclick="updateCursor()">
  <div id="dateTime"></div>
  
  <div id="toolOptions" class="tool-options">
  </div>
	<div class="tabs-colour">
    <input type="radio" id="white" name="colour"  onclick="currentColor='white'" checked>
		<label class="tab" for="white" style="background-color: white;">&nbsp;</label>
		<input type="radio" id="red" name="colour"  onclick="currentColor='red'">
		<label class="tab" for="red" style="background-color: red;">&nbsp;</label>
    <input type="radio" id="orange" name="colour"  onclick="currentColor='orange'">
		<label class="tab" for="orange" style="background-color: orange;">&nbsp;</label>
    <input type="radio" id="blue" name="colour"  onclick="currentColor='#0084ff'">
		<label class="tab" for="blue" style="background-color: #0084ff;">&nbsp;</label>
    <input type="radio" id="green" name="colour"  onclick="currentColor='#2EFF31'">
		<label class="tab" for="green" style="background-color: #2EFF31">&nbsp;</label>
    <input type="radio" id="blue-sky" name="colour"  onclick="currentColor='#c851ff'">
		<label class="tab" for="blue-sky" style="background-color: #c851ff;">&nbsp;</label>
    <input type="radio" id="purple" name="colour"  onclick="currentColor='#fa5cff'">
		<label class="tab" for="purple" style="background-color: #fa5cff;">&nbsp;</label>
    <input type="radio" id="magenta" name="colour"  onclick="currentColor='#00eeff'">
		<label class="tab" for="magenta" style="background-color: #00eeff;">&nbsp;</label>
    <input type="radio" id="grad" name="colour"  onclick="setGradient();randomizeGradient();">
		<label class="tab" for="grad" style="background: linear-gradient(45deg, red,orange,yellow,green,blue,indigo,violet);">&nbsp;</label>
    <input type="radio" id="glgrad" name="colour"  onclick="setGlobalGradient();">
		<label class="tab" for="glgrad" style="background: radial-gradient(red,orange,yellow,green,blue,indigo,violet);">&nbsp;</label>
		<input type="radio" id="custom" name="colour">
    <label class="tab" for="custom" id="customlabel" style="background: black;"><p style="position: absolute; color: white; text-shadow: 1px 1px black;">+</p>
		<input type="color" id="colorPicker" value="#000000" for="custom" onclick="document.getElementById('custom').click();document.getElementById('customlabel').style.background = document.getElementById('colorPicker').value;" onchange="document.getElementById('customlabel').style.background = document.getElementById('colorPicker').value;" style="margin-left: 0px; transform: scale(1.2); opacity: 0;"></label>
    <i class="flex-break"></i>
	</div>
    <div class="tabs">
      <!-- Vertical pencil size control replaces S/M/L/XL quick buttons -->
      <div class="pencil-vertical" title="Pencil size">
        <!-- use aria-orientation for accessibility; avoid non-standard `orient` attribute which may behave differently across engines -->
        <input id="pencilSize" class="pencil-range vertical" type="range" min="1" max="60" value="12" aria-orientation="vertical" aria-label="Pencil size">
        <div id="pencilSizeValue" class="pencil-size-value" aria-live="polite" aria-atomic="true">12</div>
      </div>
    </div>
  <div class="page-changer" onclick="updatePageCounter()">
    <button onclick="prevPage()" style="border-radius: 20px 0px 0px 20px; margin-right: -5px;" >ÔÅì</button>
    <button id="pageCounter" style="width: auto; padding-left: 10px; padding-right: 10px;" >1 / 1</button>
    <button onclick="nextPage()" style="border-radius: 0px 20px 20px 0px; margin-left: -5px;">ÔÅî</button>
  </div>

  <!-- Page viewer: overlay modal with thumbnails of all pages -->
  <div id="pageViewer" class="page-viewer" aria-hidden="true" style="display:none;">
    <div class="page-viewer-content">
      <div class="pv-header">
        <h3>Pages</h3>
        <button id="pvClose" class="pv-close">Close</button>
      </div>
      <div id="pageViewerGrid" class="page-viewer-grid"></div>
    </div>
  </div>

  <div id="toolbar" onclick="selected=null">
    <script>
      // Provide a safe fallback so the toolbar button doesn't throw if the graph module
      // hasn't been initialized yet. `scripts/graph.js` will overwrite this when ready.
      if (!window.openGraphModal) {
        window.openGraphModal = function(){
          const gm = document.getElementById('graphModal');
          if (gm) { gm.style.display = 'block'; return; }
          console.warn('openGraphModal called before graph module initialized');
          // Friendly message for users (non-blocking)
          const tip = document.getElementById('gm-error');
          if (tip) { tip.style.display='block'; tip.textContent = 'Graph module is still loading ‚Äî try again in a moment.'; setTimeout(()=>{ tip.style.display='none'; tip.textContent=''; }, 3000); }
        };
      }
    </script>
    <!-- toolbar pencil control removed (moved to quick-bar) -->
    <label style="display: none;">
      <input id="eraserSize" type="range" min="5" max="100" value="20">
    </label>

    <button onclick="undo()" style="border-radius: 20px 0px 0px 20px;">Û∞ïå</button>
    <button onclick="redo()" style="border-radius: 0px 20px 20px 0px;">Û∞ëé</button>
    <span class="sap"></span><span class="sap"></span>
    <button data-tool="select" title="Select tool" onclick="showToolOptions('select')" style="border-radius: 20px 0px 0px 20px;">Û∞áÄ</button>
    <button data-tool="lasso-eraser" onclick="showToolOptions('eraser')">Û∞áæ</button>
    <button data-tool="pencil" onclick="showToolOptions('pencil')">ÔÅÄ</button>
    <button data-tool="rect" onclick="showToolOptions('rect')">Ó©≤</button>
    <button data-tool="cuboid" onclick="showToolOptions('cuboid');" >ÔÜ≥</button>

    <button style="border-radius: 0px 20px 20px 0px;" onclick="dotsmaker()">
<div  id="dot" style="border:2px solid white;border-radius:50px;background-color:transparent;font-family:nerd;padding-top:2px;"></div>
    </button>    <span class="sap"></span>
    <button onclick="deleteaa();" style="color: #cf6679; border-radius: 20px 0px 0px 20px;">Ó™Å</button>
    <button onclick="addImage()">Û∞°º</button>
    <button onclick="addPDF()">Ôìê</button>
    <button id="toggleGrid">Û∞ãÅ</button>
    <button onclick="openGraphModal();">Û∞çò</button>
    <button id="ask">Û∞∫¥</button>
    <button onclick="location.reload(true);">Û∞ëì</button>
    <button onclick="toggleFullscreen()">Û∞äî</button>
    <button onclick="openPopupsave()">Û∞Üì</button>
    <button onclick="savePNG()">ÔáÖ</button>
    <button onclick="openPopup()">Óàó</button>
    <button onclick="deletePage()" style="border-radius: 0px 20px 20px 0px; color: #cf6679;">Ôëß</button>
  </div>

  <canvas id="stage" width="1200" height="600"></canvas>
  <div id="customCursor"></div>
  <div id="startup">
    <p id="startupText">Starting...</p>
  </div>
  <p style="position: fixed; bottom: 0px; left: 200px; color: #99999900; font-size: 10px; font-family: nerd; z-index: 9999; background: linear-gradient(135deg, #2A66A5 10%, #5A32CC 90%); --webkit-bbackground-clip: text; background-clip: text;">&copy; 2025 Nikhil</p>
  <div id="propertiesPanel">
    <div id="ckbox"></div>
  </div>
    <div id="answer" style="display: none;">
      <button id="close" onclick="document.getElementById('answer').style.right = '-60%'">x</button>
    </div>
  <div id="chartContainer" style="width:500px; height:500px; position: absolute; top: -100%">
    <canvas id="chart" width="500" height="500"></canvas>
  </div>
  <div id="popup" class="popup"><div class="popup-content"></div></div>
<div id="modalOverlay">
  <div id="modalBox">
    <h2>Load Previous Session</h2>
    <p>Do you want to load the previous session or delete all saved data?</p>
    <button class="modalBtn loadBtn" id="loadSession"onclick="handleLoad();">Load</button>
    <button class="modalBtn deleteBtn" id="deleteSession" onclick="handleDelete();">cancle</button>
  </div>
</div>
<!--- Settings -->
<button onclick="toggleSettings()" style="position:fixed; top:10px; left:10px; font-family: nerd;  font-size: 17px; color: #c9c9c9; background: rgba(0,0,0,0.2); border: none; backdrop-filter: blur(10px); padding: 5px 20px; border-radius: 11px; " id="watermark">Codraw</button>
<div id="settingsPanel" style="position:fixed;  color:#fff; padding:0px; border-radius:10px; width:760px; display:none;">
  <div class="settings-layout">
    <div class="settings-sidebar">
      <button class="settings-tab active" data-panel="general">Û∞çó<span>General</span></button>
      <button class="settings-tab" data-panel="gemini">Û∞ÄÖ<span>Gemini</span></button>
      <button class="settings-tab" data-panel="telegram">Óàó<span>Telegram</span></button>
      <button class="settings-tab" data-panel="about">Û∞ûã<span>About</span></button>
      <button class="settings-tab" data-panel="licence">Û∞øÉ<span>Licence</span></button>
    </div>
    <div class="settings-content">
      <div class="settings-panel-content" data-panel="general">
        <h3>Ó≠ë General</h3>
        <label>Watemark</label>
        <input type="text" id="watermarkinput" class="input-box" onchange="saveSettingsUI()"><br><br>
        <label>Background Color</label>
        <div class="bgrow">
          <div class="bg-colour" onclick="document.getElementById('bgColor').value = '#292966';saveSettingsUI()" style="background-color: #292966;"></div>
          <div class="bg-colour" onclick="document.getElementById('bgColor').value = '#0A3C30';saveSettingsUI()" style="background-color: #0A3C30;"></div>
          <div class="bg-colour" onclick="document.getElementById('bgColor').value = '#0a2e33';saveSettingsUI()" style="background-color: #0a2e33;"></div>
          <div class="bg-colour" onclick="document.getElementById('bgColor').value = '#332216';saveSettingsUI()" style="background-color: #332216;"></div>
          <div class="bg-colour" onclick="document.getElementById('bgColor').value = '#161821';saveSettingsUI()" style="background-color: #161821;"></div>
          <div class="bg-colour" onclick="document.getElementById('bgColor').value = '#0f0e47';saveSettingsUI()" style="background-color: #0f0e47;"></div>
          <input type="color" id="bgColor" style="height: 35px; width: 50px; border-radius: 10px;" onchange="saveSettingsUI()">
        </div>
        <br>
        <label>Subjects</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input type="text" id="subjectName" placeholder="" class="input-box" style="flex:1;">
          <button class="btnadd" onclick="addSubjectUI()">ÔÅï</button>
        </div>
        <div id="subjectList" style="margin-top:8px;"></div>
        <br>
        <label>Pencil Size</label>
        <input id="pencilSizeSetting" type="range" min="1" max="60" value="12
        "><br>
        <div class="form-group">
          <label>Show Cursor:
            <input type="checkbox" id="cursorToggle" class="remove-from-screen">
            <label for="cursorToggle" class="switch"></label>
          </label>
        </div>
        <br>
      </div>

      <div class="settings-panel-content" data-panel="gemini" style="display:none;">
        <h3>Û∞ÄÖ Gemini</h3>
        <label>Gemini API Keys (comma separated)</label>
        <textarea id="geminiKeys" class="input-box"></textarea>
        <br>
        <label>Gemini Model</label>
        <input id="geminiModel" list="geminiModels" type="text" class="input-box" placeholder="gemini-2.5-flash" onchange="saveSettingsUI()">
        <datalist id="geminiModels">
          <option value="gemini-2.5-flash"></option>
          <option value="gemini-1.5-pro"></option>
          <option value="gemini-1.5-flash"></option>
        </datalist>
        <div style="font-size:12px; color:var(--text-secondary); margin-top:6px">Try: gemini-2.5-flash, gemini-1.5-pro, gemini-1.5-flash</div>
        
      </div>
      <div class="settings-panel-content" data-panel="telegram" style="display:none;">
        <h3>Û∞ñü Telegram</h3>
        <label>Telegram Image Bot Token</label>
        <input type="text" id="telegramImageBotToken" class="input-box"><br><br>
        <label>Telegram Bot Token</label>
        <input type="text" id="telegrambotToken" class="input-box"><br><br>
        <h4>Channels</h4>
        <div id="classList"></div>
        <input type="text" id="className" placeholder="Channel Name" class="input-box">
        <input type="text" id="classChatId" placeholder="Chat ID" class="input-box">
        <button onclick="addClassUI()" class="btnadd">ÔÅï</button>
      </div>
      <div class="settings-panel-content" data-panel="about" style="display:none;">
        <h3>Û∞ûã About</h3>
        <p>Codraw &copy; 2025 - Settings</p>
      </div>
      <div class="settings-panel-content" data-panel="licence" style="display:none;">
        <h3>Û∞øÉ Licence</h3>
          <div id="licenseContent" class="license-pre"> </div>
      </div>
    </div>
  </div>
  <div style="padding:8px; text-align:right;">
    <button onclick="saveSettingsUI();toggleSettings()" class="modalBtn loadBtn">Done</button>
  </div>
</div>

<!-- Graph Modal (paste into your HTML) -->
<div id="graphModal" style="display:none; position: fixed; z-index: 99999; left:50%; top:50%; transform:translate(-50%,-50%); width: auto; max-width:94%; background: rgba(27, 28, 41, 0.854); border-radius:12px; padding: 12px; box-sizing: border-box;">
  <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
    <div class="preview" id="mathPreview" style="flex:1;  border-radius:8px; border:1px solid #444444c8; background:#0d1219e0; color:#fff; font-family: 'latin-math';" ></div>
    <input id="fnInput" placeholder="e.g. sin(x)  |  2*sin(x)  |  x^2  |  cot(x)  |  sinh(2x)" style="flex:1; padding:8px; border-radius:8px; border:1px solid #444; background:#111; color:#fff; display: none;">
    <button id="gm-plot" class="mathpt">ÓØ£</button>
    <button id="gm-import" class="mathpt">Û±ÄØ</button>
    <button id="gm-zoom-in" class="mathpt">ÓÆÅ</button>
    <button id="gm-zoom-out" class="mathpt">ÓÆÇ</button>
    <button id="gm-reset" class="mathpt">Û∞úâ</button>
    <button id="gm-close" class="mathpt" style="color:#d33;">Û∞Öö</button>
  </div>
  <div style="display:flex; gap:12px;">
    <canvas id="graphCanvas" width="500" height="500" style="flex:0 0 760px; max-width:100%; height:420px; border-radius:8px; background: transparent; border: 1px solid #444;"></canvas>
    <div id="gm-rightpanel" style="width: 220px; display:flex; flex-direction:column; gap:8px;">
      <div id="gm-keypad" style="display:grid; grid-template-columns: repeat(9, 1fr); gap:6px; display: none;"></div>
    <div class="buttons" style="margin-top:12px; font-family: 'latin-math';">
      <button>1</button><button>2</button><button>3</button><button style="font-family: 'latin-math';">ùíô</button>
      <button>4</button><button>5</button><button>6</button><button>œÄ</button>
      <button>7</button><button>8</button><button>9</button><button>e</button>
      <button>+</button><button>0</button><button>-</button><button>^</button>
      <button>*</button><button>/</button><button>‚àö</button><button>‚Üí</button>
      <button>(</button><button>.</button><button>)</button><button>‚å´</button>
      <button>sin</button><button>cos</button><button>tan</button><button>ln</button>
      <button>csc</button><button>sec</button><button>cot</button><button>log</button>
      <button>sinh</button><button>cosh</button><button>tanh</button><button>abs</button>
    </div>
  </div>
    </div>
  </div>
</div>

<script type="module">
  import * as pdfjsLib from './scripts/pdf.min.mjs';
  pdfjsLib.GlobalWorkerOptions.workerSrc = './pdf.worker.min.mjs';
  </script><script type="module">

  import * as pkg from "https://esm.run/@google/generative-ai";
  window.GoogleGenerativeAI = pkg.GoogleGenerativeAI || pkg.default.GoogleGenerativeAI;
  </script>
  <!-- Core globals & helpers (must load first) -->
  <script src="./scripts/variables.js"></script>
  <script src="./scripts/draw.js"></script>
  <script src="./scripts/functions.js"></script>

  <!-- UI panels & settings -->
  <script src="./scripts/properties.js"></script>
  <script src="./scripts/setting.js"></script>

  <!-- External libs & libs that need document ready before using -->
  <script src="./scripts/jspdf.umd.min.js"></script>

  <!-- Main app code -->
  <script src="./scripts/database.js"></script>
  <script src="./scripts/eventlistener.js"></script>

  <!-- Optional features & integrations -->
  <script src="./scripts/pdf.js"></script>
  <script src="./scripts/telegram.js"></script>
  <script src="./scripts/graph.js"></script>
  <script src="./scripts/gemini.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@google/generative-ai/dist/index.umd.js"></script>
  <script>
    showToolOptions('pencil')
  </script>

<script>

</script>

</body>
</html>